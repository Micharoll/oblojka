(this["webpackJsonpverif-vater"]=this["webpackJsonpverif-vater"]||[]).push([[0],{232:function(e,t,l){e.exports=l(372)},371:function(e,t,l){},372:function(e,t,l){"use strict";l.r(t);l(233),l(238),l(239),l(244),l(245),l(251),l(271),l(272),l(273),l(274),l(275),l(276),l(277),l(278),l(279),l(280),l(281),l(282),l(283),l(287),l(295),l(298),l(302),l(304),l(306),l(308),l(312),l(315),l(321),l(330),l(331);var a=l(0),o=l.n(a),n=l(52),r=l.n(n),c=(l(336),l(1)),i=l(375),s=l(381),d=l(382),m=l(383),u=l(384),p=l(385),g=l(103);const h="https://i-tns.ru/api/v2/",w=(e,t)=>{for(let[l,a]of Object.entries(t))a&&e.append(l,a);return e},_=async e=>{let t=new FormData;return w(t,e),t.append("jwt",localStorage.getItem("jwt")),fetch(h+"orders/",{method:"POST",body:t}).then(e=>e.json()).then(e=>e).catch(e=>({status:"error",message:"\u041e\u0448\u0438\u0431\u043a\u0430 \u0438\u043d\u0442\u0435\u0440\u043d\u0435\u0442 \u0441\u043e\u0435\u0434\u0438\u043d\u0435\u043d\u0438\u044f"}))},E=async e=>(e.append("jwt",localStorage.getItem("jwt")),fetch(h+"order/v6.php",{method:"POST",body:e}).then(e=>e.json()).then(e=>e).catch(e=>({status:"error",message:"\u041e\u0448\u0438\u0431\u043a\u0430 \u0438\u043d\u0442\u0435\u0440\u043d\u0435\u0442 \u0441\u043e\u0435\u0434\u0438\u043d\u0435\u043d\u0438\u044f, \u0434\u0430\u043d\u043d\u044b\u0435 \u0441\u043e\u0445\u0440\u0430\u043d\u0435\u043d\u044b \u0432 \u043a\u044d\u0448"}))),b=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"file";for(var l=e.split(","),a=l[0].match(/:(.*?);/)[1],o=atob(l[1]),n=o.length,r=new Uint8Array(n);n--;)r[n]=o.charCodeAt(n);return new File([r],t,{type:a})};var f=l(378),v=l(379);var y=e=>{const[t,l]=Object(a.useState)([]),[n,r]=Object(a.useState)(null);Object(a.useEffect)(()=>{let t=e.photos.filter(e=>e&&""!==e);l(t),t.length>0&&t[0]&&r(t[0])},[e.photos]);return console.log(t),t.length>0&&o.a.createElement(o.a.Fragment,null,o.a.createElement(c.j,null,o.a.createElement("a",{href:n,target:"_blank",rel:"noopener noreferrer"},o.a.createElement(c.e,{style:{height:"100vw",backgroundImage:'url("'+n+'")',backgroundSize:"cover",backgroundPosition:"center",maxHeight:500}}))),o.a.createElement(c.f,{size:"s",className:"CardScroll__photo"},t.map(t=>t.length?o.a.createElement(c.e,{key:t,className:t===n&&"Card__photo-active",onClick:()=>r(t),style:{backgroundImage:'url("'+t+'")',backgroundSize:"cover",backgroundPosition:"center"}},o.a.createElement("div",{className:"Card__photo-delete",onClick:l=>{var a;l.stopPropagation(),n===(a=t)&&r(null),e.removePhoto(a)}},o.a.createElement(f.a,{width:20,height:20})),o.a.createElement("div",{style:{paddingBottom:"80%"}})):null),o.a.createElement(c.e,{className:"Card__photo-add"},o.a.createElement("input",{id:"photo-add",type:"file",style:{display:"none"},onChange:e.changeFile}),o.a.createElement("label",{htmlFor:"photo-add"},e.loading?o.a.createElement(c.G,{size:"regular"}):o.a.createElement(o.a.Fragment,null,o.a.createElement(v.a,null),"\u0414\u043e\u0431\u0430\u0432\u0438\u0442\u044c \u0444\u043e\u0442\u043e"))),o.a.createElement(c.e,{className:"Card__photo-add"},o.a.createElement("input",{id:"photo-add-2",type:"file",style:{display:"none"},onChange:e.changeFileKv}),o.a.createElement("label",{htmlFor:"photo-add-2"},e.loading?o.a.createElement(c.G,{size:"regular"}):o.a.createElement(o.a.Fragment,null,o.a.createElement(v.a,null),"\u0414\u043e\u0431\u0430\u0432\u0438\u0442\u044c \u0444\u043e\u0442\u043e \u0441 \u043a\u0432")))))},S=l(377),I=l(376),C=l(380),j=l(162),O=l.n(j);var k=e=>{var t,l,n,r,i,s,d;let{data:m,setItem:u}=e;console.log(m);let p="null"===window.localStorage.getItem("city")?null:window.localStorage.getItem("city"),g="null"===window.localStorage.getItem("street")?null:window.localStorage.getItem("street"),h="null"===window.localStorage.getItem("house")?null:window.localStorage.getItem("house"),w="null"===window.localStorage.getItem("building")?null:window.localStorage.getItem("building"),_="null"===window.localStorage.getItem("apartment")?null:window.localStorage.getItem("apartment"),E="null"===window.localStorage.getItem("room")?null:window.localStorage.getItem("room"),b="null"===window.localStorage.getItem("ls")?null:window.localStorage.getItem("ls");const[f,v]=Object(a.useState)({city:p,street:g,house:h,building:w,apartment:_,room:E,ls:b}),[y,j]=Object(a.useState)({city:[],street:[],house:[],building:[],apartment:[],room:[],ls:[]}),[k,P]=Object(a.useState)(!0);Object(a.useEffect)(()=>{if(console.log(m),!m||0===m.length)return;let e,t,l,a,o,n=[...new Set(m.map(e=>e.city))],r=[];if(f.city&&(e=[...new Set(m.map(e=>{if(e.city===f.city)return e.street}).filter(e=>void 0!==e))]),f.street){let e={};t=m.filter(e=>e.city===f.city&&e.street===f.street).filter(t=>!e[t.house]&&(e[t.house]=1))}if(f.house){let e={};l=m.filter(e=>e.city===f.city&&e.street===f.street&&e.house===f.house).filter(t=>!e[t.building]&&(e[t.building]=1))}if(f.house){let e={};a=m.filter(e=>e.city===f.city&&e.street===f.street&&e.house===f.house&&e.building===f.building&&(null===e.room||e.room===f.room||null===f.room)).filter(t=>!e[t.apartment]&&(e[t.apartment]=1)),console.log(a)}if(f.house){let e={};o=m.filter(e=>e.city===f.city&&e.street===f.street&&e.house===f.house&&e.building===f.building&&(null===e.apartment||e.apartment===f.apartment||null===f.apartment)).filter(t=>!e[t.room]&&(e[t.room]=1))}if(f.house||f.building||f.apartment||f.room){let e={};r=m.filter(e=>e.city===f.city&&e.street===f.street&&e.house===f.house&&e.building===f.building&&e.apartment===f.apartment&&e.room===f.room).filter(t=>!e[t.ls]&&(e[t.ls]=1)),console.log(m.filter(e=>e.city===f.city&&e.street===f.street&&e.house===f.house)),1===r.length&&null===f.ls&&(console.log("\u041e\u0414\u0418\u041d \u041b\u0421"),v({...f,ls:r[0].ls}),window.localStorage.setItem("ls",r[0].ls))}if(f.ls){console.log("\u0423\u0421\u0422\u0410\u041d\u0410\u0412\u041b\u0418\u0412\u0410\u0415\u041c \u0410\u0414\u0420\u0415\u0421");let e=m.filter(e=>e.city===f.city&&e.street===f.street&&e.house===f.house&&e.building===f.building&&e.building===f.building&&e.apartment===f.apartment&&e.room===f.room&&e.ls===f.ls);console.log(e[0]),u(e[0])}j({city:n,street:e,house:t,building:l,apartment:a,room:o,ls:r})},[m,f,u]);const x=e=>{v({...f,apartment:e,ls:null}),window.localStorage.setItem("apartment",e),window.localStorage.removeItem("ls"),u(null)},z=e=>{v({...f,room:e,ls:null}),window.localStorage.setItem("room",e),window.localStorage.removeItem("ls"),u(null)},F=e=>{v({...f,ls:e}),window.localStorage.setItem("ls",e),u(null)};return console.log(y),o.a.createElement(o.a.Fragment,null,0===m.length&&o.a.createElement(c.C,{disabled:!0},"\u041d\u0435\u0442 \u0434\u043e\u0441\u0442\u0443\u043f\u043d\u044b\u0445 \u0434\u0430\u043d\u043d\u044b\u0445"),o.a.createElement(c.g,{after:k?o.a.createElement(S.a,null):o.a.createElement(I.a,null),onClick:()=>P(!k)},"\u041b\u043e\u043a\u0430\u0442\u043e\u0440"),o.a.createElement(O.a,{height:k?"auto":0},(null===(t=y.city)||void 0===t?void 0:t.length)>0&&o.a.createElement(c.l,{top:"\u0413\u043e\u0440\u043e\u0434"},o.a.createElement(c.B,{name:"city",placeholder:"\u0412\u044b\u0431\u0435\u0440\u0438\u0442\u0435 \u0433\u043e\u0440\u043e\u0434",searchable:"true",options:y.city.map(e=>({label:e,value:e})),value:f.city,onChange:e=>(e=>{v({city:e,street:null,house:null,building:null,apartment:null,room:null,ls:null}),window.localStorage.setItem("city",e),window.localStorage.removeItem("street"),window.localStorage.removeItem("house"),window.localStorage.removeItem("building"),window.localStorage.removeItem("apartment"),window.localStorage.removeItem("room"),window.localStorage.removeItem("ls"),u(null)})(e.target.value)})),f.city&&(null===(l=y.street)||void 0===l?void 0:l.length)>0&&o.a.createElement(c.l,{top:"\u0423\u043b\u0438\u0446\u0430"},o.a.createElement(c.B,{name:"street",placeholder:"\u0412\u044b\u0431\u0435\u0440\u0438\u0442\u0435 \u0443\u043b\u0438\u0446\u0443",searchable:"true",options:y.street.map(e=>({label:e,value:e})),value:f.street,onChange:e=>(e=>{v({...f,street:e,house:null,building:null,apartment:null,room:null,ls:null}),window.localStorage.setItem("street",e),window.localStorage.removeItem("house"),window.localStorage.removeItem("building"),window.localStorage.removeItem("apartment"),window.localStorage.removeItem("room"),window.localStorage.removeItem("ls"),u(null)})(e.target.value)})),f.street&&(null===(n=y.house)||void 0===n?void 0:n.length)>0&&o.a.createElement(c.l,{top:"\u0414\u043e\u043c"},o.a.createElement(c.q,{showArrows:!0,getScrollToLeft:e=>e-120,getScrollToRight:e=>e+120},o.a.createElement(c.J,{mode:"buttons",style:{display:"flex"}},y.house.map(e=>o.a.createElement("div",{className:"mh4",key:e.house},o.a.createElement(c.K,{selected:e.house===f.house,onClick:()=>(e=>{v({...f,house:e,building:null,apartment:null,room:null,ls:null}),window.localStorage.setItem("house",e),window.localStorage.removeItem("building"),window.localStorage.removeItem("apartment"),window.localStorage.removeItem("room"),window.localStorage.removeItem("ls"),u(null)})(e.house)},e.house)))))),f.house&&(null===(r=y.building)||void 0===r?void 0:r.length)>0&&o.a.createElement(c.l,{top:"\u041a\u043e\u0440\u043f\u0443\u0441"},o.a.createElement(c.q,{showArrows:!0,getScrollToLeft:e=>e-120,getScrollToRight:e=>e+120},o.a.createElement(c.J,{mode:"buttons",style:{display:"flex"}},y.building.map(e=>o.a.createElement("div",{className:"mh4",key:e.building},o.a.createElement(c.K,{selected:e.building===f.building,onClick:()=>(e=>{v({...f,building:e,apartment:null,room:null,ls:null}),window.localStorage.setItem("building",e),window.localStorage.removeItem("apartment"),window.localStorage.removeItem("room"),window.localStorage.removeItem("ls"),u(null)})(e.building)},e.building?e.building:"\u041d\u0435\u0442"))))))),f.house&&(null===(i=y.apartment)||void 0===i?void 0:i.length)>0&&o.a.createElement(c.l,{top:"\u041a\u0432\u0430\u0440\u0442\u0438\u0440\u0430"},o.a.createElement(c.q,{showArrows:!0,getScrollToLeft:e=>e-120,getScrollToRight:e=>e+120},o.a.createElement(c.J,{mode:"buttons",style:{display:"flex"}},y.apartment.filter(e=>!e.filled&&"0"===e.done).map(e=>o.a.createElement("div",{className:"mh4",key:e.id},o.a.createElement(c.K,{selected:e.apartment===f.apartment,onClick:()=>x(e.apartment)},e.apartment?e.apartment:"\u041d\u0435\u0442"))),y.apartment.filter(e=>e.filled||"1"===e.done).map(e=>o.a.createElement("div",{className:"mh4",key:e.id},o.a.createElement(c.K,{selected:e.apartment===f.apartment,onClick:()=>x(e.apartment),after:o.a.createElement(C.a,{style:"1"===e.done?{color:"var(--accent)"}:{color:"var(--vkui--color_text_secondary)"}})},e.apartment?e.apartment:"\u041d\u0435\u0442")))))),f.house&&(null===(s=y.room)||void 0===s?void 0:s.length)>0&&o.a.createElement(c.l,{top:"\u041a\u043e\u043c\u043d\u0430\u0442\u0430"},o.a.createElement(c.q,{showArrows:!0,getScrollToLeft:e=>e-120,getScrollToRight:e=>e+120},o.a.createElement(c.J,{mode:"buttons",style:{display:"flex"}},y.room.filter(e=>!e.filled&&"0"===e.done).map(e=>o.a.createElement("div",{className:"mh4",key:e.id},o.a.createElement(c.K,{selected:e.room===f.room,onClick:()=>z(e.room)},e.room?e.room:"\u041d\u0435\u0442"))),y.room.filter(e=>e.filled||"1"===e.done).map(e=>o.a.createElement("div",{className:"mh4",key:e.id},o.a.createElement(c.K,{selected:e.room===f.room,onClick:()=>z(e.room),after:o.a.createElement(C.a,{style:"1"===e.done?{color:"var(--accent)"}:{color:"var(--vkui--color_text_secondary)"}})},e.room?e.room:"\u041d\u0435\u0442")))))),(null===(d=y.ls)||void 0===d?void 0:d.length)>1&&o.a.createElement(c.l,{top:"\u041b\u0421"},o.a.createElement(c.q,{showArrows:!0,getScrollToLeft:e=>e-120,getScrollToRight:e=>e+120},o.a.createElement(c.J,{mode:"buttons",style:{display:"flex"}},y.ls.filter(e=>!e.filled&&"0"===e.done).map(e=>o.a.createElement("div",{className:"mh4",key:e.id},o.a.createElement(c.K,{selected:e.ls===f.ls,onClick:()=>F(e.ls)},e.ls?e.ls:"\u041d\u0435\u0442"))),y.ls.filter(e=>e.filled||"1"===e.done).map(e=>o.a.createElement("div",{className:"mh4",key:e.id},o.a.createElement(c.K,{selected:e.ls===f.ls,onClick:()=>F(e.ls),after:o.a.createElement(C.a,{style:"1"===e.done?{color:"var(--accent)"}:{color:"var(--vkui--color_text_secondary)"}})},e.ls?e.ls:"\u041d\u0435\u0442")))))))};var P=e=>{var t,l,n,r,w;let{dataOrders:_,db:f,openModalMessage:v,setDataOrders:S}=e;const[I]=Object(a.useState)(null!==window.localStorage.getItem("name")?window.localStorage.getItem("name"):""),[C,j]=Object(a.useState)(null),[O,P]=Object(a.useState)(!1),[x,z]=Object(a.useState)(null),F=Object(a.useRef)(null),M=Object(a.useRef)(null);Object(a.useEffect)(()=>{},[_]);const R=e=>{let t="checkbox"===e.target.type?e.target.checked:e.target.value,l=e.target.name;j({...C,[l]:t,done:"0",filled:!1})},T=async()=>{await f.put("orders",C,parseInt(C.id))},N=async e=>{try{if(e.target.files&&e.target.files.length>0){P(!0);const t=await Object(g.a)(e.target.files[0],{maxSizeMB:null!==window.localStorage.getItem("imgSlider")?window.localStorage.getItem("imgSlider"):1,maxWidthOrHeight:1920,useWebWorker:!0}),l=new FileReader;l.addEventListener("load",async()=>{j({...C,photos_blob:A(C.photos_blob,[l.result]),done:"0",filled:!1}),await f.put("orders",C,parseInt(C.id)),F&&F.current&&setTimeout(()=>F.current.focus(),200),P(!1)}),l.readAsDataURL(t)}}catch(t){console.log("error"+t),v(JSON.stringify(t))}},D=async e=>{try{if(console.log("changeFileKv"),e.target.files&&e.target.files.length>0){P(!0);const t=await Object(g.a)(e.target.files[0],{maxSizeMB:null!==window.localStorage.getItem("imgSlider")?window.localStorage.getItem("imgSlider"):1,maxWidthOrHeight:1920,useWebWorker:!0}),l=new FileReader;l.addEventListener("load",async()=>{var e=document.createElement("canvas"),t=e.getContext("2d"),a=new Image;a.src=l.result,a.addEventListener("load",async l=>{e.width=a.width,e.height=a.height,t.font=a.width/5+"px Verdana",t.fillStyle="#fff",t.drawImage(a,0,0);let o=C.apartment||C.room||C.building,n=t.measureText(o).width;t.fillText(o,e.width/2-n/2,a.height/2);var r=e.toDataURL("image/jpeg");console.log(r),j({...C,photos_blob:A(C.photos_blob,[r]),done:"0",filled:!1}),await f.put("orders",C,parseInt(C.id)),F&&F.current&&setTimeout(()=>F.current.focus(),200),P(!1)})}),l.readAsDataURL(t)}}catch(t){console.log("error"+t),v(JSON.stringify(t))}},B=async()=>{try{var e,t;j({...C,loading:!0});let l=new FormData;if(I&&l.append("name",I),null!==C.id&&l.append("id",C.id),null!==C.value_meter&&l.append("value_meter",C.value_meter),null!==C.value_meter_2&&l.append("value_meter_2",C.value_meter_2),null!==C.value_meter_3&&l.append("value_meter_3",C.value_meter_3),null!==C.type_pu&&l.append("type_pu",C.type_pu),null!==C.num_pu&&l.append("num_pu",C.num_pu),null!==C.installation_location&&l.append("installation_location",C.installation_location),null!==C.count_zones&&l.append("count_zones",C.count_zones),null!==C.note&&l.append("note",C.note),null!==C.city&&l.append("city",C.city),null!==C.street&&l.append("street",C.street),null!==C.house&&l.append("house",C.house),null!==C.building&&l.append("building",C.building),null!==C.apartment&&l.append("apartment",C.apartment),null!==C.room&&l.append("room",C.room),null!==C.ls&&l.append("ls",C.ls),null!==C.folder&&l.append("folder",C.folder),null!==C.fio_consumer&&l.append("fio_consumer",C.fio_consumer),null!==C.seal_type_num&&l.append("seal_type_num",C.seal_type_num),l.append("act_url",C.act_url),l.append("act_rental_url",C.act_rental_url),null!==C.create_act_url&&l.append("create_act_url",C.create_act_url),(null===(e=C.photo_delete)||void 0===e?void 0:e.length)>0&&l.append("photo_delete",JSON.stringify(C.photo_delete)),(null===(t=C.photos_blob)||void 0===t?void 0:t.length)>0)for(let e of C.photos_blob){let t=await b(e);console.log(t),l.append("file[]",t)}let a=await E(l),n={...C};"ok"===a.status?(a.url&&(n.photos=n.photos?n.photos+","+a.url:a.url),a.act_rental_url&&(n.act_rental_url=a.act_rental_url),n.photos_blob=null,n.done="1",n.filled=!0,n.loading=!1,a.act_url&&(n.act_url=a.act_url)):(n.loading=!1,n.filled=!0,n.done="0",function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";z(o.a.createElement(c.E,{layout:"vertical",onClose:()=>z(null),before:"ok"===t&&o.a.createElement(c.c,{size:24,style:{background:"var(--accent)"}},o.a.createElement(i.a,{fill:"#fff",width:14,height:14}))||"error"===t&&o.a.createElement(c.c,{size:24,style:{background:"var(--dynamic_red)"}},o.a.createElement(s.a,{fill:"#fff",width:14,height:14}))||null},e))}(a.message||"\u041e\u0448\u0438\u0431\u043a\u0430","error")),j(n);let r=[];_.forEach(e=>{e.id===C.id?r.push({...n}):r.push({...e})}),S(r),await f.put("orders",n,parseInt(C.id))}catch(l){console.log("error"+l),v(JSON.stringify(l))}},A=function(){for(var e=arguments.length,t=new Array(e),l=0;l<e;l++)t[l]=arguments[l];return[].concat(...t.filter(Array.isArray)).filter(e=>null!==e&&void 0!==e)},[J,L]=Object(a.useState)(""),[K,G]=Object(a.useState)(!1);Object(a.useEffect)(()=>{(null===C||void 0===C?void 0:C.apartment)&&L(C.apartment.trim())},[C]);return console.log("item",C),o.a.createElement(o.a.Fragment,null,o.a.createElement(c.o,null,o.a.createElement(k,{data:_,setItem:j}),C&&(C.photos||(null===(t=C.photos_blob)||void 0===t?void 0:t.length))?o.a.createElement(y,{photos:A(C.photos?C.photos.split(","):[],C.photos_blob),loading:O,changeFile:N,changeFileKv:D,removePhoto:e=>{var t,l;if(null===(t=C.photos_blob)||void 0===t?void 0:t.includes(e))j({...C,done:"0",filled:!1,photos_blob:C.photos_blob.filter(t=>t!==e)});else if(null===(l=C.photos)||void 0===l?void 0:l.includes(e)){let t=C.photos.split(",").filter(t=>t!==e).join(","),l=C.photo_delete?[...C.photo_delete,e]:[e];j({...C,done:"0",filled:!1,photos:t,photo_delete:l})}}}):null,C&&!C.photos&&!(null===(l=C.photos_blob)||void 0===l?void 0:l.length)&&o.a.createElement(c.j,null,o.a.createElement(c.k,{id:"btnPhoto",getRef:M,before:O?o.a.createElement(c.G,{size:"regular"}):o.a.createElement(d.a,null),size:"l",stretched:!0,accept:"image/*",capture:"true"===window.localStorage.getItem("selectPhotoGalery")?null:"environment",onChange:N},"\u0421\u0434\u0435\u043b\u0430\u0442\u044c \u0444\u043e\u0442\u043e")),C&&!C.photos&&!(null===(n=C.photos_blob)||void 0===n?void 0:n.length)&&o.a.createElement(c.j,null,o.a.createElement(c.k,{id:"btnPhoto",getRef:M,before:O?o.a.createElement(c.G,{size:"regular"}):o.a.createElement(d.a,null),size:"l",stretched:!0,accept:"image/*",capture:"true"===window.localStorage.getItem("selectPhotoGalery")?null:"environment",onChange:D},"\u0421\u0434\u0435\u043b\u0430\u0442\u044c \u0444\u043e\u0442\u043e \u0441 \u043a\u0432\u0430\u0440\u0442\u0438\u0440\u043e\u0439")),C&&"operator"===window.localStorage.getItem("role")&&o.a.createElement(c.l,{top:"\u0414\u043e\u0431\u0430\u0432\u0438\u0442\u044c \u0444\u043e\u0442\u043e \u043f\u043e \u043d\u043e\u043c\u0435\u0440\u0443 \u043a\u0432\u0430\u0440\u0442\u0438\u0440\u044b"},o.a.createElement("div",{className:"Flex__Input"},o.a.createElement(c.t,{className:"Flex__Input_width",placeholder:"\u0412\u0432\u0435\u0434\u0438\u0442\u0435 \u043d\u043e\u043c\u0435\u0440 \u043a\u0432\u0430\u0440\u0442\u0438\u0440\u044b",value:J,onChange:e=>L(e.target.value),after:J.length>0&&o.a.createElement(c.r,{hoverMode:"opacity","aria-label":"\u041e\u0447\u0438\u0441\u0442\u0438\u0442\u044c \u043f\u043e\u043b\u0435",onClick:()=>L("")},o.a.createElement(m.a,null))}),o.a.createElement(c.d,{onClick:async()=>{G(!0),console.log(J);let e=await(async e=>{let t=new FormData;return t.append("jwt",window.localStorage.getItem("jwt")),t.append("appartment",e),fetch(h+"img/searchPhoto.php",{method:"POST",body:t}).then(e=>e.json()).then(e=>e).catch(e=>!1)})(J);if(console.log(e),"ok"===e.status&&e.data){let t=await fetch(e.data).then(e=>e.blob());if(t){const e=new FileReader;e.addEventListener("load",async()=>{console.log(e.result),j({...C,photos_blob:A(C.photos_blob,[e.result]),done:"0",filled:!1}),await f.put("orders",C,parseInt(C.id)),G(!1)}),e.readAsDataURL(t)}}}},K?o.a.createElement(c.G,null):o.a.createElement(u.a,null)))),C&&o.a.createElement(o.a.Fragment,null,C.act_url?o.a.createElement(c.C,{multiline:!0,disabled:!0,after:o.a.createElement(p.a,{onClick:async()=>{j({...C,act_url:null,done:"0",filled:!1}),await f.put("orders",C,parseInt(C.id))}})},o.a.createElement(c.s,{header:"\u0421\u0441\u044b\u043b\u043a\u0430 \u043d\u0430 \u0430\u043a\u0442 \u043d\u0435\u0434\u043e\u043f\u0443\u0441\u043a\u0430"},o.a.createElement("a",{href:C.act_url,target:"_blank",rel:"noopener noreferrer"},C.act_url))):o.a.createElement(c.l,null,o.a.createElement(c.h,{name:"create_act_url",checked:C.create_act_url||!1,onChange:R},"\u041e\u0444\u043e\u0440\u043c\u0438\u0442\u044c \u0430\u043a\u0442 \u043d\u0435\u0434\u043e\u043f\u0443\u0441\u043a\u0430")),C.act_rental_url&&o.a.createElement(c.C,{multiline:!0,disabled:!0,after:o.a.createElement(p.a,{onClick:async()=>{j({...C,act_rental_url:null,done:"0",filled:!1}),await f.put("orders",C,parseInt(C.id))}})},o.a.createElement(c.s,{header:"\u0421\u0441\u044b\u043b\u043a\u0430 \u043d\u0430 \u0430\u043a\u0442 \u0441\u044a\u0451\u043c\u0430"},o.a.createElement("a",{href:C.act_rental_url,target:"_blank",rel:"noopener noreferrer"},C.act_rental_url))),C.type&&o.a.createElement(c.C,{disabled:!0,multiline:!0},o.a.createElement(c.s,{header:"\u0412\u0438\u0434 \u0440\u0430\u0431\u043e\u0442"},C.type)),C.ls&&o.a.createElement(c.C,{disabled:!0,multiline:!0},o.a.createElement(c.s,{header:"\u041b\u0438\u0446\u0435\u0432\u043e\u0439 \u0441\u0447\u0451\u0442"},C.ls)),o.a.createElement(c.l,{top:"\u041a\u043e\u043b\u0438\u0447\u0435\u0441\u0442\u0432\u043e \u0437\u043e\u043d \u0441\u0447\u0451\u0442\u0447\u0438\u043a\u0430"},o.a.createElement(c.B,{placeholder:"\u0412\u044b\u0431\u0435\u0440\u0438\u0442\u0435 \u043a\u043e\u043b\u0438\u0447\u0435\u0441\u0442\u0432\u043e \u0437\u043e\u043d",name:"count_zones",options:[{label:"1",value:"1"},{label:"2",value:"2"},{label:"3",value:"3"}],value:C.count_zones||"",onChange:R,onBlur:T})),o.a.createElement(c.l,{top:"\u041f\u043e\u043a\u0430\u0437\u0430\u043d\u0438\u0435 (\u043e\u0431\u0449.)"},o.a.createElement(c.t,{name:"value_meter",value:C.value_meter||"",onChange:R,onBlur:T,type:"number",placeholder:"\u0412\u0432\u0435\u0434\u0438\u0442\u0435 \u043f\u043e\u043a\u0430\u0437\u0430\u043d\u0438\u0435",getRef:F})),o.a.createElement(c.l,{top:"\u041f\u043e\u043a\u0430\u0437\u0430\u043d\u0438\u0435 (\u043d\u043e\u0447\u044c)"},o.a.createElement(c.t,{name:"value_meter_2",value:C.value_meter_2||"",onChange:R,onBlur:T,type:"number",placeholder:"\u0412\u0432\u0435\u0434\u0438\u0442\u0435 \u043f\u043e\u043a\u0430\u0437\u0430\u043d\u0438\u0435"})),o.a.createElement(c.l,{top:"\u041f\u043e\u043a\u0430\u0437\u0430\u043d\u0438\u0435 (\u043f\u043e\u043b\u0443\u043f\u0438\u043a)"},o.a.createElement(c.t,{name:"value_meter_3",value:C.value_meter_3||"",onChange:R,onBlur:T,type:"number",placeholder:"\u0412\u0432\u0435\u0434\u0438\u0442\u0435 \u043f\u043e\u043a\u0430\u0437\u0430\u043d\u0438\u0435"})),o.a.createElement(c.l,{top:"\u0424\u0418\u041e \u043f\u043e\u0442\u0440\u0435\u0431\u0438\u0442\u0435\u043b\u044f"},o.a.createElement(c.t,{name:"fio_consumer",value:C.fio_consumer||"",onChange:R,onBlur:T,placeholder:"\u0412\u0432\u0435\u0434\u0438\u0442\u0435 \u0424\u0418\u041e \u043f\u043e\u0442\u0440\u0435\u0431\u0438\u0442\u0435\u043b\u044f"})),o.a.createElement(c.l,{top:"\u0422\u0438\u043f \u041f\u0423"},o.a.createElement(c.t,{name:"type_pu",value:C.type_pu||"",onChange:R,onBlur:T,placeholder:"\u0412\u0432\u0435\u0434\u0438\u0442\u0435  \u0442\u0438\u043f \u041f\u0423"})),o.a.createElement(c.l,{top:"\u041d\u043e\u043c\u0435\u0440 \u041f\u0423"},o.a.createElement(c.t,{name:"num_pu",value:C.num_pu||"",onChange:R,onBlur:T,placeholder:"\u0412\u0432\u0435\u0434\u0438\u0442\u0435 \u043d\u043e\u043c\u0435\u0440 \u041f\u0423"})),o.a.createElement(c.l,{top:"\u041d\u043e\u043c\u0435\u0440 \u0438 \u0442\u0438\u043f \u043f\u043b\u043e\u043c\u0431\u044b"},o.a.createElement(c.t,{name:"seal_type_num",value:C.seal_type_num||"",onChange:R,onBlur:T,placeholder:"\u0412\u0432\u0435\u0434\u0438\u0442\u0435 \u043d\u043e\u043c\u0435\u0440 \u0438 \u0442\u0438\u043f \u043f\u043b\u043e\u043c\u0431\u044b"})),o.a.createElement(c.l,{top:"\u041c\u0435\u0441\u0442\u043e \u0443\u0441\u0442\u0430\u043d\u043e\u0432\u043a\u0438 \u041f\u0423"},o.a.createElement(c.B,{placeholder:"\u0412\u044b\u0431\u0435\u0440\u0438\u0442\u0435 \u043c\u0435\u0441\u0442\u043e \u0443\u0441\u0442\u0430\u043d\u043e\u0432\u043a\u0438",name:"installation_location",options:[...new Set([C.installation_location,"\u041b\u0435\u0441\u0442\u043d\u0438\u0447\u043d\u0430\u044f \u043f\u043b\u043e\u0449\u0430\u0434\u043a\u0430","\u041a\u0432\u0430\u0440\u0442\u0438\u0440\u0430","\u041a\u043e\u043c\u043d\u0430\u0442\u0430","\u0412\u0435\u0440\u0430\u043d\u0434\u0430","\u0413\u0430\u0440\u0430\u0436","\u0416\u0438\u043b\u043e\u0439 \u0434\u043e\u043c","\u041d\u0430 \u043e\u043f\u043e\u0440\u0435","\u0421\u0430\u0440\u0430\u0439","\u0422\u0430\u043c\u0431\u0443\u0440 \u0432 \u043f\u043e\u0434\u044a\u0435\u0437\u0434\u0435 \u041c\u0416\u0414","\u0424\u0430\u0441\u0430\u0434 \u0437\u0434\u0430\u043d\u0438\u044f"])].map(e=>({label:e,value:e})),value:C.installation_location||"",onChange:R,onBlur:T})),C.updated&&o.a.createElement(c.C,{disabled:!0,multiline:!0},o.a.createElement(c.s,{header:"\u0414\u0430\u0442\u0430 \u043f\u0440\u043e\u0432\u0435\u0434\u0435\u043d\u0438\u044f \u0440\u0430\u0431\u043e\u0442"},C.updated)),o.a.createElement(c.l,{top:"\u041f\u0440\u0438\u043c\u0435\u0447\u0430\u043d\u0438\u0435"},o.a.createElement(c.L,{rows:1,placeholder:"\u0412\u0432\u0435\u0434\u0438\u0442\u0435 \u043f\u0440\u0438\u043c\u0435\u0447\u0430\u043d\u0438\u0435",name:"note",value:C.note||"",onChange:R,onBlur:T})),C&&o.a.createElement(c.m,{onSubmit:e=>{e.preventDefault(),B()}},o.a.createElement(c.j,null,o.a.createElement(c.d,{stretched:!0,disabled:(null===C.value_meter||0===(null===(r=C.value_meter)||void 0===r?void 0:r.length))&&!0!==C.create_act_url||(!C.photos_blob||0===(null===(w=C.photos_blob)||void 0===w?void 0:w.length))&&(void 0===C.photos||null===C.photos)||"0"===C.done&&C.filled||"1"===C.done,onClick:B,size:"l",loading:C.loading},"1"===C.done&&"\u0421\u043e\u0445\u0440\u0430\u043d\u0435\u043d\u043e","0"===C.done&&C.filled&&"\u0417\u0430\u043f\u043e\u043b\u043d\u0435\u043d\u043e","0"===C.done&&!C.filled&&"\u041e\u0442\u043f\u0440\u0430\u0432\u0438\u0442\u044c"))))),x)},x=l(386),z=l(9);const F={"/":new z.Page("panel_main","view_main"),"/auth":new z.Page("panel_auth","view_main"),"/settings":new z.Page("panel_settings","view_main")},M=new z.Router(F);M.start();var R=e=>{let{id:t,dataOrders:l,db:n,openModalMessage:r,setDataOrders:i}=e;const s=Object(z.useRouter)(),[d]=Object(a.useState)(null!==window.localStorage.getItem("name")?window.localStorage.getItem("name"):"");return o.a.createElement(c.w,{id:t},o.a.createElement(c.x,{left:o.a.createElement(c.z,{"aria-label":"\u041d\u0430\u0441\u0442\u0440\u043e\u0439\u043a\u0438",onClick:()=>s.pushPage("/settings")},o.a.createElement(x.a,null))},"\u0421\u044a\u0451\u043c"),!d&&o.a.createElement(c.o,null,o.a.createElement(c.l,null,o.a.createElement(c.n,{header:"\u0412\u0432\u0435\u0434\u0438\u0442\u0435 \u0441\u0432\u043e\u0451 \u0438\u043c\u044f"},"\u0412\u0432\u0435\u0434\u0438\u0442\u0435 \u0441\u0432\u043e\u0451 \u0438\u043c\u044f \u0432 \u043d\u0430\u0441\u0442\u0440\u043e\u0439\u043a\u0430\u0445 \u0441\u0435\u0440\u0432\u0438\u0441\u0430"))),o.a.createElement(P,{dataOrders:l,db:n,openModalMessage:r,setDataOrders:i}))};l(371);var T=e=>{let{id:t,openModalMessage:l,setJwt:n}=e;const[r]=Object(a.useState)("auth"),[i,s]=Object(a.useState)(""),[d,m]=Object(a.useState)(""),[u,p]=Object(a.useState)(!1),g=Object(z.useRouter)(),_=async()=>{p(!0);const e=await(async e=>{let t=new FormData;return w(t,e),fetch(h+"auth/",{method:"POST",body:t}).then(e=>e.json()).then(e=>e).catch(e=>({status:"error",message:"\u041e\u0448\u0438\u0431\u043a\u0430 \u0438\u043d\u0442\u0435\u0440\u043d\u0435\u0442 \u0441\u043e\u0435\u0434\u0438\u043d\u0435\u043d\u0438\u044f"}))})({login:i,password:d});"ok"===e.status?(n(e.jwt),window.localStorage.setItem("jwt",e.jwt),window.localStorage.setItem("login",i),window.localStorage.setItem("role",e.role),g.replacePage("/")):l(e.message,"\u041e\u0448\u0438\u0431\u043a\u0430"),p(!1)};return o.a.createElement(c.w,{id:t},o.a.createElement(c.F,{size:16}),o.a.createElement(c.o,null,o.a.createElement(c.m,null,o.a.createElement(c.l,{top:"\u041b\u043e\u0433\u0438\u043d"},o.a.createElement(c.t,{placeholder:"\u0412\u0432\u0435\u0434\u0438\u0442\u0435 \u043b\u043e\u0433\u0438\u043d",value:i,onChange:e=>s(e.target.value)})),o.a.createElement(c.l,{top:"\u041f\u0430\u0440\u043e\u043b\u044c"},o.a.createElement(c.t,{placeholder:"\u0412\u0432\u0435\u0434\u0438\u0442\u0435 \u043f\u0430\u0440\u043e\u043b\u044c",type:"password",value:d,onChange:e=>m(e.target.value),autocomplete:"on"})),o.a.createElement(c.j,null,"auth"===r&&o.a.createElement(c.d,{type:"submit",stretched:!0,size:"l",onClick:_,disabled:0===i.length||0===d.length,loading:u},"\u0412\u043e\u0439\u0442\u0438"),"registration"===r&&o.a.createElement(c.d,{type:"submit",stretched:!0,size:"l",onClick:async()=>{p(!0);let e=await(async e=>{let t=new FormData;return w(t,e),fetch(h+"user/",{method:"POST",body:t}).then(e=>e.json()).then(e=>e).catch(e=>({status:"error",message:"\u041e\u0448\u0438\u0431\u043a\u0430 \u0438\u043d\u0442\u0435\u0440\u043d\u0435\u0442 \u0441\u043e\u0435\u0434\u0438\u043d\u0435\u043d\u0438\u044f"}))})({login:i,password:d});"error"===e.status?l(e.message,"\u041e\u0448\u0438\u0431\u043a\u0430"):_(),p(!1)},disabled:0===i.length||0===d.length,loading:u},"\u0417\u0430\u0440\u0435\u0433\u0438\u0441\u0442\u0440\u0438\u0440\u043e\u0432\u0430\u0442\u044c\u0441\u044f")))))};function N(e){let{id:t,modalMessageTitle:l,modalMessageText:a}=e;const n=Object(z.useRouter)();return o.a.createElement(c.u,{id:t,onClose:()=>n.popPage(),header:l,subheader:a})}var D=l(163),B=l(387);function A(e){let{id:t,waitDownload:l,loadOrders:a}=e;const n=Object(z.useRouter)();return o.a.createElement(c.u,{id:t,icon:l?o.a.createElement(c.G,{size:"large",style:{margin:"6px 0"}}):o.a.createElement(B.a,null),onClose:()=>n.popPage(),header:"\u041f\u043e\u0434\u0442\u0432\u0435\u0440\u0434\u0438\u0442\u0435 \u043e\u0431\u043d\u043e\u0432\u043b\u0435\u043d\u0438\u0435",subheader:"\u0412\u0441\u0435 \u0441\u043e\u0445\u0440\u0430\u043d\u0435\u043d\u0438\u044f \u043d\u0430 \u0443\u0441\u0442\u0440\u043e\u0439\u0441\u0442\u0432\u0435 \u0443\u0434\u0430\u043b\u044f\u0442\u044c\u0441\u044f. \u0412\u044b \u0443\u0432\u0435\u0440\u0435\u043d\u044b, \u0447\u0442\u043e \u0445\u043e\u0442\u0438\u0442\u0435 \u043e\u0431\u043d\u043e\u0432\u0438\u0442\u044c \u0434\u0430\u043d\u043d\u044b\u0435?"},o.a.createElement(c.F,null),o.a.createElement(c.d,{size:"l",onClick:()=>a(!1),disabled:l,mode:"destructive"},"\u041e\u0431\u043d\u043e\u0432\u0438\u0442\u044c \u0434\u0430\u043d\u043d\u044b\u0435"))}function J(e){let{id:t,onExit:l}=e;const a=Object(z.useRouter)();return o.a.createElement(c.u,{id:t,icon:o.a.createElement(B.a,null),onClose:()=>a.popPage(),header:"\u041f\u043e\u0434\u0442\u0432\u0435\u0440\u0434\u0438\u0442\u0435 \u0432\u044b\u0445\u043e\u0434",subheader:"\u0412\u0441\u0435 \u0442\u0435\u043a\u0443\u0449\u0435\u0435 \u0441\u043e\u0445\u0440\u0430\u043d\u0435\u043d\u0438\u044f \u043d\u0430 \u0443\u0441\u0442\u0440\u043e\u0439\u0441\u0442\u0432\u0435 \u0443\u0434\u0430\u043b\u044f\u0442\u044c\u0441\u044f. \u0412\u044b \u0443\u0432\u0435\u0440\u0435\u043d\u044b, \u0447\u0442\u043e \u0445\u043e\u0442\u0438\u0442\u0435 \u0432\u044b\u0439\u0442\u0438?"},o.a.createElement(c.F,null),o.a.createElement(c.d,{size:"l",onClick:l,mode:"destructive"},"\u0412\u044b\u0439\u0442\u0438"))}var L=l(388);var K=e=>{let{id:t,data:l,db:n,setDataOrders:r}=e;const d=Object(z.useRouter)(),[m,u]=Object(a.useState)(null!==window.localStorage.getItem("name")?window.localStorage.getItem("name"):""),[p,g]=Object(a.useState)(!1),[w,_]=Object(a.useState)(null),[f,v]=Object(a.useState)("true"===window.localStorage.getItem("autoCam")),[y,S]=Object(a.useState)("true"===window.localStorage.getItem("selectPhotoGalery")),[I,C]=Object(a.useState)("true"===window.localStorage.getItem("previewPhoto")),[j]=Object(a.useState)(window.localStorage.getItem("login")),[O,k]=Object(a.useState)(null!==window.localStorage.getItem("imgSlider")?window.localStorage.getItem("imgSlider"):.1),[P,x]=Object(a.useState)({});Object(a.useEffect)(()=>{F()},[]);const F=async()=>{let e=await(async()=>{let e=new FormData;return e.append("jwt",localStorage.getItem("jwt")),e.append("name",localStorage.getItem("name")),fetch(h+"orders/getStats.php",{method:"POST",body:e}).then(e=>e.json()).then(e=>e).catch(e=>({status:"error",message:"\u041e\u0448\u0438\u0431\u043a\u0430 \u0438\u043d\u0442\u0435\u0440\u043d\u0435\u0442 \u0441\u043e\u0435\u0434\u0438\u043d\u0435\u043d\u0438\u044f"}))})();x(null===e||void 0===e?void 0:e.data)};return o.a.createElement(c.w,{id:t},o.a.createElement(c.x,{left:o.a.createElement(c.y,{onClick:()=>d.popPage()})},"\u041d\u0430\u0441\u0442\u0440\u043e\u0439\u043a\u0438"),o.a.createElement(c.o,null,o.a.createElement(c.j,{style:{display:"flex"}},o.a.createElement(c.t,{value:m,onChange:e=>u(e.target.value),placeholder:"\u0412\u0432\u0435\u0434\u0438\u0442\u0435 \u0424\u0418\u041e",style:{width:"100%",marginRight:8}}),o.a.createElement(c.d,{size:"l",onClick:()=>window.localStorage.setItem("name",m)},o.a.createElement(L.a,null))),o.a.createElement(c.l,null,o.a.createElement(c.h,{checked:f,onChange:e=>{window.localStorage.setItem("autoCam",e.target.checked),v(e.target.checked)}},"\u0410\u0432\u0442\u043e\u043c\u0430\u0442\u0438\u0447\u0435\u0441\u043a\u043e\u0435 \u043e\u0442\u043a\u0440\u044b\u0442\u0438\u0435 \u043a\u0430\u043c\u0435\u0440\u044b"),o.a.createElement(c.h,{checked:y,onChange:e=>{window.localStorage.setItem("selectPhotoGalery",e.target.checked),S(e.target.checked)}},"\u0412\u044b\u0431\u043e\u0440 \u0444\u043e\u0442\u043e \u0438\u0437 \u0433\u0430\u043b\u0435\u0440\u0435\u0438"),o.a.createElement(c.h,{checked:I,onChange:e=>{window.localStorage.setItem("previewPhoto",e.target.checked),C(e.target.checked)}},"\u041f\u0440\u0435\u0434\u043f\u0440\u043e\u0441\u043c\u043e\u0442\u0440 \u0444\u043e\u0442\u043e")),o.a.createElement(c.l,{top:"\u0421\u0436\u0430\u0442\u0438\u0435 \u0438\u0437\u043e\u0431\u0440\u0430\u0436\u0435\u043d\u0438\u044f \u0434\u043e "+O+" \u041c\u0431"},o.a.createElement(c.D,{max:1,min:.1,step:.1,onChange:e=>{let t=parseFloat(e).toFixed(1);k(t),window.localStorage.setItem("imgSlider",t)},value:O})),o.a.createElement(c.p,{mode:"secondary"},"\u0421\u0442\u0430\u0442\u0438\u0441\u0442\u0438\u043a\u0430 \u043f\u043e \u043b\u043e\u0433\u0438\u043d\u0443"),o.a.createElement(c.C,{disabled:!0},j),o.a.createElement(c.C,{indicator:l.length,disabled:!0},"\u0410\u0434\u0440\u0435\u0441\u043e\u0432 \u043f\u043e \u043f\u043b\u0430\u043d\u0443"),o.a.createElement(c.C,{indicator:l.filter(e=>e.filled&&"0"===e.done).length,disabled:!0},"\u0410\u0434\u0440\u0435\u0441\u043e\u0432 \u0432 \u043a\u044d\u0448\u0435"),o.a.createElement(c.C,{indicator:l.filter(e=>"1"===e.done).length,disabled:!0},"\u0410\u0434\u0440\u0435\u0441\u043e\u0432 \u043d\u0430 \u0441\u0435\u0440\u0432\u0435\u0440\u0435"),o.a.createElement(c.C,{indicator:P.act_url,disabled:!0},"\u0410\u043a\u0442\u043e\u0432 \u043d\u0435\u0434\u043e\u043f\u0443\u0441\u043a\u0430 \u043d\u0430 \u0441\u0435\u0440\u0432\u0435\u0440\u0435"),o.a.createElement(c.C,{indicator:P.act_rental_url,disabled:!0},"\u0410\u043a\u0442\u043e\u0432 \u0441\u044a\u0451\u043c\u0430 \u043d\u0430 \u0441\u0435\u0440\u0432\u0435\u0440\u0435"),o.a.createElement(c.p,{mode:"secondary"},"\u0421\u0442\u0430\u0442\u0438\u0441\u0442\u0438\u043a\u0430 \u043f\u043e \u0424\u0418\u041e"),o.a.createElement(c.C,{indicator:P.fio_act_url,disabled:!0},"\u0410\u043a\u0442\u043e\u0432 \u043d\u0435\u0434\u043e\u043f\u0443\u0441\u043a\u0430 \u043d\u0430 \u0441\u0435\u0440\u0432\u0435\u0440\u0435"),o.a.createElement(c.C,{indicator:P.fio_act_rental_url,disabled:!0},"\u0410\u043a\u0442\u043e\u0432 \u0441\u044a\u0451\u043c\u0430 \u043d\u0430 \u0441\u0435\u0440\u0432\u0435\u0440\u0435"),o.a.createElement(c.g,{Component:"a",href:"https://cu56702.tmweb.ru/cache/",target:"__blank"},"\u041f\u0440\u043e\u0432\u0435\u0440\u043a\u0430 \u043a\u044d\u0448\u0430"),o.a.createElement(c.j,null,o.a.createElement(c.d,{size:"l",stretched:!0,onClick:()=>{g(!0);let e=!1,t=setInterval(async()=>{if(!e){e=!0;let u=l.filter(e=>e.filled&&"0"===e.done)[0];if(u){var a,d;let p=new FormData;if(m&&p.append("name",m),null!==u.id&&p.append("id",u.id),null!==u.value_meter&&p.append("value_meter",u.value_meter),null!==u.value_meter_2&&p.append("value_meter_2",u.value_meter_2),null!==u.value_meter_3&&p.append("value_meter_3",u.value_meter_3),null!==u.type_pu&&p.append("type_pu",u.type_pu),null!==u.num_pu&&p.append("num_pu",u.num_pu),null!==u.installation_location&&p.append("installation_location",u.installation_location),null!==u.count_zones&&p.append("count_zones",u.count_zones),null!==u.note&&p.append("note",u.note),null!==u.city&&p.append("city",u.city),null!==u.street&&p.append("street",u.street),null!==u.house&&p.append("house",u.house),null!==u.building&&p.append("building",u.building),null!==u.apartment&&p.append("apartment",u.apartment),null!==u.room&&p.append("room",u.room),null!==u.ls&&p.append("ls",u.ls),null!==u.folder&&p.append("folder",u.folder),null!==u.fio_consumer&&p.append("fio_consumer",u.fio_consumer),null!==u.seal_type_num&&p.append("seal_type_num",u.seal_type_num),null!==u.create_act_url&&p.append("create_act_url",u.create_act_url),p.append("act_url",u.act_url),p.append("act_rental_url",u.act_rental_url),(null===(a=u.photo_delete)||void 0===a?void 0:a.length)>0&&p.append("photo_delete",JSON.stringify(u.photo_delete)),(null===(d=u.photos_blob)||void 0===d?void 0:d.length)>0)for(let e of u.photos_blob){let t=await b(e);console.log(t),p.append("file[]",t)}let h=await E(p),w=u;if("ok"===h.status){h.url&&(w.photos=w.photos?w.photos+","+h.url:h.url),w.photos_blob=null,w.done="1",w.filled=!0,h.act_url&&(w.act_url=h.act_url),await n.put("orders",w,parseInt(w.id));let e=l.map(e=>e.id===w.id?w:e);r(e)}else!function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";_(o.a.createElement(c.E,{layout:"vertical",onClose:()=>_(null),before:"ok"===t&&o.a.createElement(c.c,{size:24,style:{background:"var(--accent)"}},o.a.createElement(i.a,{fill:"#fff",width:14,height:14}))||"error"===t&&o.a.createElement(c.c,{size:24,style:{background:"var(--dynamic_red)"}},o.a.createElement(s.a,{fill:"#fff",width:14,height:14}))||null},e))}(h.message||"\u041e\u0448\u0438\u0431\u043a\u0430","error"),g(!1),clearInterval(t);e=!1}else g(!1),clearInterval(t)}},1e3)},loading:p,disabled:0===l.filter(e=>e.filled&&"0"===e.done).length},"\u041e\u0442\u043f\u0440\u0430\u0432\u0438\u0442\u044c \u0434\u0430\u043d\u043d\u044b\u0435 \u0438\u0437 \u043a\u044d\u0448\u0430")),o.a.createElement(c.j,{style:{display:"flex"}},o.a.createElement(c.d,{size:"l",stretched:!0,mode:"destructive",onClick:()=>d.pushModal("modal_confirm_update"),style:{marginRight:8}},"\u041e\u0431\u043d\u043e\u0432\u0438\u0442\u044c \u0434\u0430\u043d\u043d\u044b\u0435"),o.a.createElement(c.d,{size:"l",stretched:!0,mode:"destructive",onClick:()=>d.pushModal("modal_confirm_exit")},"\u0412\u044b\u0439\u0442\u0438"))),w)};var G=function(){const e=Object(z.useLocation)(),t=Object(z.useRouter)(),[l,n]=Object(a.useState)(window.localStorage.getItem("jwt")),[r,i]=Object(a.useState)(null),[s,d]=Object(a.useState)(null),[m,u]=Object(a.useState)([]),[p,g]=Object(a.useState)(""),[h,w]=Object(a.useState)(""),[E,b]=Object(a.useState)(!1);Object(a.useEffect)(()=>{null===l&&t.replacePage("/auth"),null===window.localStorage.getItem("autoCam")&&window.localStorage.setItem("autoCam",!0),null===window.localStorage.getItem("recognitionVal")&&window.localStorage.setItem("recognitionVal",!0),f()},[]);const f=async()=>{try{const e=await Object(D.a)("orders-store",1,{upgrade(e){e.createObjectStore("orders")}});d(o.a.createElement(c.A,null));let t=await e.getAll("orders");console.log("before filter",t),u(t),d(null),i(e)}catch(e){d(null),y(JSON.stringify(e))}},v=async function(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];try{e&&d(o.a.createElement(c.A,null)),await r.clear("orders");const a={photo_blob:null,filled:!1};b(!0);let n=[],i=!0,s=0;for(;i;){let e=await _({offset:s,count:1e4});"ok"===e.status&&e.data.length>0?(n=[...n,...e.data],s+=e.data.length):i=!1}n=n.map(e=>({...e,...a})),console.log(n);for(const e in n)try{await r.put("orders",n[e],parseInt(n[e].id))}catch(l){d(null),y(JSON.stringify(l))}b(!1),u(n),w("\u041e\u043a"),e?(g("\u0414\u0430\u043d\u043d\u044b\u0435 \u0437\u0430\u0433\u0440\u0443\u0436\u0435\u043d\u044b"),d(null),t.pushModal("modal_message")):(g("\u0414\u0430\u043d\u043d\u044b\u0435 \u043e\u0431\u043d\u043e\u0432\u043b\u0435\u043d\u044b"),t.replaceModal("modal_message"))}catch(l){d(null),y(JSON.stringify(l))}},y=function(e){let l=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"\u041e\u0448\u0438\u0431\u043a\u0430";g(e),w(l),t.pushModal("modal_message")},S=o.a.createElement(c.v,{activeModal:e.getModalId(),onClose:()=>t.popPage()},o.a.createElement(N,{id:"modal_message",onClose:()=>t.popPage(),modalMessageText:p,modalMessageTitle:h}),o.a.createElement(A,{id:"modal_confirm_update",onClose:()=>t.popPage(),waitDownload:E,loadOrders:v}),o.a.createElement(J,{id:"modal_confirm_exit",onClose:()=>t.popPage(),onExit:async()=>{u([]),await r.clear("orders"),t.popPage(),window.localStorage.removeItem("jwt"),setTimeout(()=>t.replacePage("/auth"),300)}}));return o.a.createElement(c.i,{webviewType:c.N.INTERNAL},o.a.createElement(c.a,null,o.a.createElement(c.b,null,o.a.createElement(c.I,{modal:S,popout:s,style:{justifyContent:"center"}},o.a.createElement(c.H,{maxWidth:800,spaced:window.innerWidth>800},o.a.createElement(c.M,{id:"view_main",onSwipeBack:()=>t.popPage(),history:e.hasOverlay()?[]:e.getViewHistory("view_main"),activePanel:e.getViewActivePanel("view_main")},o.a.createElement(R,{id:"panel_main",dataOrders:m,db:r,openModalMessage:y,setDataOrders:u}),o.a.createElement(T,{id:"panel_auth",openModalMessage:y,loadOrders:v,setJwt:n}),o.a.createElement(K,{id:"panel_settings",data:m,db:r,openModalMessage:y,setDataOrders:u})))))))};r.a.render(o.a.createElement(z.RouterContext.Provider,{value:M},o.a.createElement(G,null)),document.getElementById("root"))}},[[232,1,2]]]);
//# sourceMappingURL=main.06c7ec1b.chunk.js.map